<!-- index.htmll -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>STEPS FETP India Decision Aid</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="app-header-left">
      <div class="app-logo-circle" aria-hidden="true">S</div>
      <div class="app-title-block">
        <h1 class="app-title">STEPS</h1>
        <div class="app-subtitle">FETP India Decision Aid Tool</div>
      </div>
    </div>

    <div class="app-header-center">
      <div class="app-header-line">World Bank / WHO style</div>
      <div class="app-header-line">Local-first, static deployment</div>
    </div>

    <div class="app-header-right">
      <span class="badge badge-primary">Next-gen build</span>
      <span class="badge badge-soft" id="dataStatusBadge">Loading data</span>
      <button class="btn-ghost-small" id="themeToggleBtn" type="button" title="Toggle dark theme">Theme</button>
      <button class="btn-primary-small" id="copyCopilotBtnTop" type="button" title="Copy Copilot package">Copy</button>
    </div>
  </header>

  <main class="app-shell">
    <nav class="tab-bar" aria-label="Primary tabs">
      <button class="tablink tab-link active" data-tab="aboutTab" type="button">About</button>
      <button class="tablink tab-link" data-tab="attributesTab" type="button">Attributes</button>
      <button class="tablink tab-link" data-tab="settingsTab" type="button">Settings</button>
      <button class="tablink tab-link" data-tab="configTab" type="button">Configuration</button>
      <button class="tablink tab-link" data-tab="resultsTab" type="button">Results</button>
      <button class="tablink tab-link" data-tab="costingTab" type="button">Costing</button>
      <button class="tablink tab-link" data-tab="sensitivityTab" type="button">Sensitivity</button>
      <button class="tablink tab-link" data-tab="copilotTab" type="button">Copilot</button>
      <button class="tablink tab-link" data-tab="technicalTab" type="button">Technical appendix</button>
    </nav>

    <section id="aboutTab" class="tabcontent tab-panel active" role="tabpanel">
      <div class="grid-two-stretch">
        <div class="card">
          <div class="card-title-row">
            <h2>Purpose</h2>
            <button class="info-icon" type="button" data-tooltip="This tool is designed for static hosting (for example GitHub Pages). All computations run locally in the browser.">i</button>
          </div>
          <p class="text-muted">
            The STEPS tool translates configured FETP programme scenarios into indicative costs, benefits, and summary cost benefit indicators using locally loaded JSON configuration files.
          </p>
          <hr class="divider" />
          <p class="note">
            If the tool shows “Data not loaded”, confirm that the JSON files are deployed at the same folder level as this page and that GitHub Pages is serving them with the correct paths.
          </p>
          <div class="button-row button-row-main">
            <button class="btn-primary" id="recalcBtn" type="button">Recalculate</button>
            <button class="btn-secondary" id="resetBtn" type="button">Reset to defaults</button>
            <button class="btn-ghost" id="runTourBtn" type="button">Guided tour</button>
          </div>
        </div>

        <div class="card card-secondary config-summary-card">
          <div class="config-summary-header">
            <h2>Scenario snapshot</h2>
            <span class="badge badge-outline" id="scenarioBadge">Default</span>
          </div>

          <div class="config-summary" id="scenarioSummary"></div>

          <div class="config-endorsement-row">
            <div class="config-endorsement-label">
              <span class="metric-label">Headline indicator</span>
              <button class="info-icon" type="button" data-tooltip="This headline indicator is derived from the configured cost benefit indicators and is intended as a quick summary rather than a decision rule.">i</button>
            </div>
            <span class="status-pill status-neutral" id="headlineStatusPill">Not calculated</span>
          </div>

          <div class="headline-text" id="headlineText">
            Configure the programme and select Recalculate to populate results.
          </div>
        </div>
      </div>

      <div class="video-card">
        <div class="video-card-header">
          <div class="video-card-title">Optional introduction video</div>
          <span class="badge badge-soft">Embed-ready</span>
        </div>
        <div class="video-wrapper" aria-label="Video placeholder">
          <iframe title="STEPS intro (optional)" src="about:blank"></iframe>
        </div>
      </div>
    </section>

    <section id="attributesTab" class="tabcontent tab-panel" role="tabpanel">
      <div class="card">
        <div class="card-title-row">
          <h2>Attributes and levels</h2>
          <button class="info-icon" type="button" data-tooltip="This section is UI-facing only. It is kept concise; supporting detail should be provided via tooltips.">i</button>
        </div>
        <div class="attributes-layout">
          <div class="attr-table-card" id="attrTable"></div>
        </div>
      </div>
    </section>

    <section id="settingsTab" class="tabcontent tab-panel" role="tabpanel">
      <div class="grid-two">
        <div class="card">
          <div class="card-title-row">
            <h2>Advanced settings</h2>
            <button class="info-icon" type="button" data-tooltip="Advanced settings control model assumptions such as discounting and display currency.">i</button>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="displayCurrency">Display currency</label>
              <select id="displayCurrency"></select>
              <p class="hint">Display conversion only; core calculations are stored in INR.</p>
            </div>

            <div class="form-group">
              <label for="inrPerUsd">INR per USD</label>
              <input id="inrPerUsd" type="number" step="1" min="1" />
              <p class="hint">Used only for display conversions.</p>
            </div>

            <div class="form-group">
              <label for="discountRateAnnual">Annual discount rate</label>
              <input id="discountRateAnnual" type="number" step="0.005" min="0" max="0.2" />
              <p class="hint">Applied to multi-year totals where relevant.</p>
            </div>

            <div class="form-group">
              <label for="applyDiscountOutbreak">Apply discounting to outbreak benefits</label>
              <select id="applyDiscountOutbreak">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
              <p class="hint">If enabled, outbreak benefits are discounted over the planning horizon.</p>
            </div>

            <div class="form-group form-group-wide">
              <label>Settings log</label>
              <div class="advanced-log-box" id="settingsLog">Settings will appear here after data are loaded.</div>
            </div>
          </div>
        </div>

        <div class="card card-secondary">
          <div class="card-title-row">
            <h2>Data sources</h2>
            <button class="info-icon" type="button" data-tooltip="These files are loaded at runtime via fetch. On GitHub Pages, ensure the paths match the deployed filenames.">i</button>
          </div>
          <div class="technical-preview" id="dataSourcesBox"></div>
        </div>
      </div>
    </section>

    <section id="configTab" class="tabcontent tab-panel" role="tabpanel">
      <div class="card card-config">
        <div class="card-title-row">
          <h2>Programme configuration</h2>
          <button class="info-icon" type="button" data-tooltip="Response time is fixed at 7 days in this build. The dropdown remains visible but other options are disabled.">i</button>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="tierSelect">Programme tier</label>
            <select id="tierSelect"></select>
          </div>

          <div class="form-group">
            <label for="traineesPerCohort">Trainees per cohort</label>
            <input id="traineesPerCohort" type="number" min="1" step="1" />
          </div>

          <div class="form-group">
            <label for="numCohorts">Number of cohorts</label>
            <input id="numCohorts" type="number" min="1" step="1" />
          </div>

          <div class="form-group">
            <label for="planningYears">Planning horizon (years)</label>
            <input id="planningYears" type="number" min="1" max="10" step="1" />
          </div>

          <div class="form-group">
            <label for="responseTimeDays">Outbreak response time (days)</label>
            <select id="responseTimeDays"></select>
            <p class="hint">Fixed at 7 days for all scenarios.</p>
          </div>

          <div class="form-group">
            <label for="economicCostToggle">Economic cost (include opportunity cost)</label>
            <select id="economicCostToggle">
              <option value="false">No</option>
              <option value="true">Yes</option>
            </select>
          </div>

          <div class="form-group form-group-wide">
            <div class="button-row button-row-main">
              <button class="btn-primary" id="applyBtn" type="button">Apply configuration</button>
              <button class="btn-secondary" id="saveScenarioBtn" type="button">Save scenario</button>
              <button class="btn-ghost" id="loadScenarioBtn" type="button">Load scenario</button>
            </div>
            <p class="hint">Saved scenarios are stored locally in your browser storage.</p>
          </div>
        </div>
      </div>

      <div class="card card-secondary assumption-log">
        <div class="card-title-row">
          <h2>Assumption log</h2>
          <button class="info-icon" type="button" data-tooltip="This log records the model assumptions used in the current calculation run, including which JSON files were loaded.">i</button>
        </div>
        <pre class="assumption-log-text" id="assumptionLog">Waiting for data load.</pre>
      </div>
    </section>

    <section id="resultsTab" class="tabcontent tab-panel" role="tabpanel">
      <div class="card">
        <div class="card-title-row">
          <h2>Headline results</h2>
          <button class="info-icon" type="button" data-tooltip="These are indicative results based on the current configuration and the JSON defaults. They are not a substitute for programme budgeting and impact evaluation.">i</button>
        </div>

        <div class="kpi-grid" id="kpiGrid"></div>

        <div class="chart-block">
          <h3>Costs and benefits</h3>
          <canvas id="costBenefitChart" height="120"></canvas>
        </div>

        <div class="headline-briefing">
          <h4>Briefing text</h4>
          <p class="text-muted" id="briefingText"></p>
        </div>
      </div>
    </section>

    <section id="costingTab" class="tabcontent tab-panel" role="tabpanel">
      <div class="costing-layout">
        <div class="costing-left">
          <div class="card">
            <div class="card-title-row">
              <h2>Cost breakdown</h2>
              <button class="info-icon" type="button" data-tooltip="Component shares are derived from the aggregated template for the selected tier. They are scaled linearly by the number of cohorts configured.">i</button>
            </div>
            <div class="cost-summary" id="costSummary"></div>
            <div class="table-wrapper">
              <table class="data-table" id="costTable">
                <thead>
                  <tr>
                    <th>Major</th>
                    <th>Category</th>
                    <th>Sub-category</th>
                    <th class="numeric-col">Total</th>
                    <th>Opportunity</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="costing-error hidden" id="costingError"></div>
          </div>
        </div>

        <div class="costing-right">
          <div class="card card-secondary">
            <div class="card-title-row">
              <h2>Export</h2>
              <button class="info-icon" type="button" data-tooltip="Export is HTML print-ready. Use your browser print dialog to save as PDF.">i</button>
            </div>
            <div class="export-toolbar">
              <button class="btn-primary-small" id="printBtn" type="button">Print / PDF</button>
              <button class="btn-ghost-small" id="copySummaryBtn" type="button">Copy summary</button>
            </div>
            <div class="technical-preview" id="exportPreview"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="sensitivityTab" class="tabcontent tab-panel" role="tabpanel">
      <div class="card">
        <div class="card-title-row">
          <h2>Sensitivity</h2>
          <button class="info-icon" type="button" data-tooltip="Sensitivity uses the same base configuration and varies a small number of parameters to show how indicators respond.">i</button>
        </div>

        <div class="sensitivity-controls-panel">
          <div class="sensitivity-controls-grid">
            <div class="form-group">
              <label for="sensOutbreakValue">Value per outbreak (INR)</label>
              <input id="sensOutbreakValue" type="number" step="1000000000" min="0" />
              <p class="hint">Overrides the tier value per outbreak for this table only.</p>
            </div>

            <div class="form-group">
              <label for="sensGradRate">Graduation rate</label>
              <input id="sensGradRate" type="number" step="0.01" min="0" max="1" />
              <p class="hint">Overrides the tier graduation rate for this table only.</p>
            </div>

            <div class="form-group">
              <label for="sensOutbreaksPerYear">Outbreaks per cohort per year</label>
              <input id="sensOutbreaksPerYear" type="number" step="0.05" min="0" />
              <p class="hint">Overrides the tier outbreak frequency for this table only.</p>
            </div>

            <div class="form-group">
              <label for="sensRunBtn">Run sensitivity</label>
              <button class="btn-primary" id="sensRunBtn" type="button">Update table</button>
              <p class="hint">Uses fixed response time of 7 days.</p>
            </div>
          </div>
          <div class="sensitivity-controls-note" id="sensNote"></div>
        </div>

        <div class="table-wrapper">
          <table class="data-table sensitivity-table" id="sensTable">
            <thead>
              <tr>
                <th>Case</th>
                <th class="numeric-col">Total cost</th>
                <th class="numeric-col">Total benefit</th>
                <th class="numeric-col">Net benefit</th>
                <th class="numeric-col">BCR</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="sensitivity-caption" id="sensCaption"></div>
      </div>
    </section>

    <section id="copilotTab" class="tabcontent tab-panel" role="tabpanel">
      <div class="copilot-layout">
        <div class="card">
          <div class="card-title-row">
            <h2>Copilot briefing package</h2>
            <button class="info-icon" type="button" data-tooltip="This tab does not send data to external services. It prepares a text package that you can copy and paste into your own Copilot environment.">i</button>
          </div>

          <p class="copilot-instructions">
            Use the buttons to generate a complete scenario package. Then open your preferred Copilot environment and paste the package.
          </p>

          <div class="copilot-actions">
            <button class="btn-primary" id="generateCopilotBtn" type="button">Generate package</button>
            <button class="btn-secondary" id="copyCopilotBtn" type="button">Copy package</button>
            <span class="copilot-url-pill" id="copilotUrlPill">https://copilot.microsoft.com/</span>
            <span class="copilot-actions-text" id="copilotActionsText"></span>
          </div>

          <div class="copilot-help-box">
            Copy and paste the package into the University Copilot environment where available.
          </div>
        </div>

        <div class="copilot-prompt-panel">
          <div class="copilot-prompt-header">
            <div>
              <div class="copilot-prompt-title">Prompt + JSON package</div>
              <div class="copilot-prompt-hint">Generated locally, safe to copy</div>
            </div>
            <button class="copilot-copy-btn" id="copyCopilotBtnDark" type="button">
              <span class="copilot-copy-icon">⧉</span> Copy
            </button>
          </div>

          <div class="copilot-prompt-body">
            <textarea id="copilotPackage" spellcheck="false"></textarea>
          </div>

          <div class="copilot-status-row">
            <span id="copilotStatusText">Not generated.</span>
            <span class="copilot-status-pill" id="copilotStatusPill">Idle</span>
          </div>
        </div>
      </div>
    </section>

    <section id="technicalTab" class="tabcontent tab-panel" role="tabpanel">
      <div class="card">
        <div class="card-title-row">
          <h2>Technical appendix</h2>
          <button class="info-icon" type="button" data-tooltip="This appendix summarises how the tool reads JSON configuration and computes costs and benefits in-browser.">i</button>
        </div>
        <div class="technical-preview" id="technicalBox"></div>
      </div>
    </section>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <div id="tour-overlay" class="tour-overlay hidden" aria-hidden="true"></div>
  <div id="tour-popover" class="tour-popover hidden" role="dialog" aria-modal="true">
    <div class="tour-popover-header">
      <h3 id="tourTitle">Tour</h3>
      <button class="tour-close-btn" id="tourCloseBtn" type="button" aria-label="Close">×</button>
    </div>
    <div class="tour-popover-body" id="tourBody"></div>
    <div class="tour-popover-footer">
      <div class="tour-step-indicator" id="tourStepIndicator"></div>
      <div class="tour-buttons">
        <button class="btn-ghost-small" id="tourPrevBtn" type="button">Back</button>
        <button class="btn-primary-small" id="tourNextBtn" type="button">Next</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
