<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>STEPS FETP India Decision Aid</title>
    <meta
      name="description"
      content="STEPS FETP India Decision Aid with preference based endorsement, willingness to pay benefits, epidemiological outbreak benefits, sensitivity, Copilot prompt, and exports."
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="styles.css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  </head>

  <body>
    <header class="app-header">
      <div class="app-header-inner">
        <div class="brand">
          <div class="brand-mark" aria-hidden="true">S</div>
          <div class="brand-text">
            <div class="brand-title">STEPS FETP India Decision Aid</div>
            <div class="brand-subtitle">Preference evidence, costs, outbreak benefits, sensitivity, Copilot and exports</div>
          </div>
        </div>

        <div class="header-actions">
          <button id="btn-start-tour" class="btn-ghost" type="button">Start guided tour</button>

          <div class="currency-pill">
            <span class="currency-label">Currency</span>
            <div class="pill-group" role="group" aria-label="Currency toggle">
              <button type="button" class="pill-toggle active" data-currency="INR">INR</button>
              <button type="button" class="pill-toggle" data-currency="USD">USD</button>
            </div>
            <span id="currency-label" class="currency-chip">INR</span>
          </div>
        </div>
      </div>
    </header>

    <nav class="tabs" aria-label="STEPS navigation">
      <div class="tabs-inner">
        <button class="tab-link active" type="button" data-tab="about">About</button>
        <button class="tab-link" type="button" data-tab="attributes">Attributes and levels</button>
        <button class="tab-link" type="button" data-tab="settings">Settings</button>
        <button class="tab-link" type="button" data-tab="configuration">Configuration</button>
        <button class="tab-link" type="button" data-tab="results">Results</button>
        <button class="tab-link" type="button" data-tab="costing">Costing</button>
        <button class="tab-link" type="button" data-tab="national">National view</button>
        <button class="tab-link" type="button" data-tab="sensitivity">Sensitivity</button>
        <button class="tab-link" type="button" data-tab="copilot">Copilot</button>
        <button class="tab-link" type="button" data-tab="scenarios">Saved scenarios</button>
      </div>
    </nav>

    <main class="app-main">
      <section id="tab-about" class="tab-panel active" aria-label="About">
        <div class="panel-grid">
          <div class="card" data-tour-step data-tour-title="What STEPS does" data-tour-content="STEPS combines preference evidence, costs, and outbreak benefit assumptions to help compare alternative FETP scale up configurations.">
            <div class="card-header">
              <h2>Purpose</h2>
            </div>
            <div class="card-body">
              <p>
                STEPS supports structured discussions on Field Epidemiology Training Programme scale up in India by combining
                mixed logit preference evidence (endorsement and willingness to pay), programme costing, and an epidemiological
                module that converts outbreak responses into indicative monetary benefits using transparent assumptions.
              </p>
              <p>
                The workflow is: set assumptions in <strong>Settings</strong>, define a configuration in <strong>Configuration</strong>,
                review outputs in <strong>Results</strong>, explore cost composition in <strong>Costing</strong>, review aggregate
                implications in <strong>National view</strong>, compare scenarios in <strong>Sensitivity</strong> and <strong>Saved scenarios</strong>,
                then prepare a narrative brief in <strong>Copilot</strong>.
              </p>
            </div>
          </div>

          <div class="card" data-tour-step data-tour-title="Key interpretation concepts" data-tour-content="These definitions are used across tabs for endorsement, opt out, willingness to pay, costs, and outbreak benefits.">
            <div class="card-header">
              <h2>Key concepts</h2>
            </div>
            <div class="card-body">
              <div class="definition-row">
                <div class="definition-title">
                  Endorsement and opt out
                  <span id="endorsement-optout-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                </div>
                <div class="definition-text">
                  Predicted shares from the mixed logit preference model for choosing the configured FETP option versus choosing the opt out alternative.
                </div>
              </div>

              <div class="definition-row">
                <div class="definition-title">
                  Willingness to pay
                  <span id="wtp-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                </div>
                <div class="definition-text">
                  An implied rupee value derived from preference coefficients that summarises how much value stakeholders attach to the configuration per trainee per month.
                </div>
              </div>

              <div class="definition-row">
                <div class="definition-title">
                  Epidemiological outbreak benefits
                  <span id="epi-implications-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                </div>
                <div class="definition-text">
                  Indicative monetary benefits based on graduates, outbreak responses per year, response time multipliers, planning horizon, discounting, and the assumed value per outbreak.
                </div>
              </div>

              <div class="definition-row">
                <div class="definition-title">
                  Opportunity cost
                  <span id="opp-cost-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                </div>
                <div class="definition-text">
                  The value of trainee time during training, included in economic costs when the opportunity cost switch is enabled.
                </div>
              </div>

              <div class="callout">
                <div class="callout-title">
                  Preference model
                  <span id="preference-model-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                </div>
                <p class="callout-text">
                  STEPS uses a mixed logit model to generate endorsement and willingness to pay summaries for the configured option relative to an opt out alternative.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-attributes" class="tab-panel" aria-label="Attributes and levels">
        <div class="card">
          <div class="card-header">
            <h2>Attributes and levels used in STEPS</h2>
          </div>
          <div class="card-body">
            <div class="attr-grid" data-tour-step data-tour-title="Attributes and levels" data-tour-content="These are the programme features that drive preference based endorsement and willingness to pay in STEPS.">
              <div class="attr-card">
                <div class="attr-icon" aria-hidden="true">üéì</div>
                <div class="attr-title">Programme tier</div>
                <div class="attr-levels">
                  <span class="chip">Frontline</span>
                  <span class="chip">Intermediate</span>
                  <span class="chip">Advanced</span>
                </div>
                <span class="attr-info info-icon" data-tooltip="Tier affects duration, cost templates, and preference evidence through tier coefficients." role="button" tabindex="0">i</span>
              </div>

              <div class="attr-card">
                <div class="attr-icon" aria-hidden="true">üèÖ</div>
                <div class="attr-title">Career incentive</div>
                <div class="attr-levels">
                  <span class="chip">Certificate</span>
                  <span class="chip">University qualification</span>
                  <span class="chip">Government career pathway</span>
                </div>
                <span class="attr-info info-icon" data-tooltip="Career incentives shift preference based utility and therefore endorsement and willingness to pay." role="button" tabindex="0">i</span>
              </div>

              <div class="attr-card">
                <div class="attr-icon" aria-hidden="true">ü§ù</div>
                <div class="attr-title">Mentorship intensity</div>
                <div class="attr-levels">
                  <span class="chip">Low</span>
                  <span class="chip">Medium</span>
                  <span class="chip">High</span>
                </div>
                <span class="attr-info info-icon" data-tooltip="Mentorship intensity shifts the preference utility and can influence implementation requirements and costs." role="button" tabindex="0">i</span>
              </div>

              <div class="attr-card">
                <div class="attr-icon" aria-hidden="true">üß©</div>
                <div class="attr-title">Delivery mode</div>
                <div class="attr-levels">
                  <span class="chip">Blended</span>
                  <span class="chip">Fully in person</span>
                  <span class="chip">Fully online</span>
                </div>
                <span class="attr-info info-icon" data-tooltip="Delivery mode has a strong preference effect and can change feasibility, travel needs, and field exposure." role="button" tabindex="0">i</span>
              </div>

              <div class="attr-card">
                <div class="attr-icon" aria-hidden="true">‚è±Ô∏è</div>
                <div class="attr-title">Outbreak response time</div>
                <div class="attr-levels">
                  <span class="chip">Within 7 days</span>
                </div>
                <span class="attr-info info-icon" data-tooltip="Response time is currently fixed at within 7 days in STEPS. The dropdown remains visible but other values are disabled." role="button" tabindex="0">i</span>
              </div>

              <div class="attr-card">
                <div class="attr-icon" aria-hidden="true">üí∞</div>
                <div class="attr-title">Cost per trainee per month</div>
                <div class="attr-levels">
                  <span class="chip">Slider input</span>
                </div>
                <span class="attr-info info-icon" data-tooltip="Cost enters the preference model as a continuous term and is also used to compute programme costs per cohort." role="button" tabindex="0">i</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-settings" class="tab-panel" aria-label="Settings">
        <div class="panel-grid">
          <div class="card" data-tour-step data-tour-title="Session settings" data-tour-content="Use these settings to control assumptions that affect outbreak benefit calculations and currency display.">
            <div class="card-header">
              <h2>Session settings</h2>
            </div>
            <div class="card-body">
              <div class="form-grid">
                <div class="form-field">
                  <label for="adv-planning-horizon">Planning horizon (years)</label>
                  <input id="adv-planning-horizon" type="number" min="1" step="1" value="5" />
                  <span class="help-inline">Used for discounting outbreak benefit values over time.</span>
                </div>

                <div class="form-field">
                  <label for="adv-epi-discount-rate">Discount rate for benefits (percent)</label>
                  <input id="adv-epi-discount-rate" type="number" min="0" step="0.1" value="3" />
                  <span class="help-inline">Applies to outbreak benefit present value calculations.</span>
                </div>

                <div class="form-field">
                  <label for="adv-usd-rate">INR per USD exchange rate</label>
                  <input id="adv-usd-rate" type="number" min="1" step="0.01" value="83" />
                  <span class="help-inline">A display conversion only. Costs and benefits are stored in INR.</span>
                </div>

                <div class="form-field">
                  <label for="adv-completion-rate">Completion rate (percent)</label>
                  <input id="adv-completion-rate" type="number" min="0" max="100" step="0.1" value="90" />
                  <span class="help-inline">Applied to trainees per cohort to determine expected graduates.</span>
                </div>

                <div class="form-field">
                  <label for="adv-outbreaks-per-graduate">Outbreak responses per graduate per year</label>
                  <input id="adv-outbreaks-per-graduate" type="number" min="0" step="0.01" value="0.5" />
                  <span class="help-inline">Used to translate graduates into outbreak responses per year.</span>
                </div>

                <div class="form-field">
                  <label for="adv-value-per-outbreak">Value per outbreak response (INR)</label>
                  <input id="adv-value-per-outbreak" type="number" min="0" step="1000000" value="20000000000" />
                  <span class="help-inline">A monetary value used to convert outbreak responses into indicative benefits.</span>
                </div>

                <div class="form-field">
                  <label for="adv-value-per-graduate">Value per graduate (INR)</label>
                  <input id="adv-value-per-graduate" type="number" min="0" step="100000" value="0" />
                  <span class="help-inline">Currently set to zero in defaults. Included for extensibility.</span>
                </div>
              </div>

              <div class="btn-row">
                <button id="adv-apply-settings" class="btn-primary" type="button">Apply advanced settings</button>
                <button id="adv-reset-settings" class="btn-ghost" type="button">Reset to defaults</button>

                <button id="settings-apply" class="btn-ghost" type="button" aria-label="Apply settings and log summary">
                  Apply and log settings
                </button>
              </div>

              <div class="log-box">
                <div class="log-title">Settings log</div>
                <div id="adv-settings-log" class="log-content" aria-live="polite"></div>
                <div id="settings-log" class="log-content visually-hidden" aria-hidden="true"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Quick outbreak value presets</h2>
            </div>
            <div class="card-body">
              <div class="form-grid">
                <div class="form-field">
                  <label for="outbreak-value-preset">Value per outbreak response preset (billion INR)</label>
                  <select id="outbreak-value-preset">
                    <option value="0" selected>Select a preset</option>
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                    <option value="40">40</option>
                  </select>
                  <span class="help-inline">Selecting a preset updates the value per outbreak used in the epidemiological module.</span>
                </div>
              </div>

              <div class="btn-row">
                <button id="apply-outbreak-value" class="btn-primary" type="button">Apply outbreak value preset</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-configuration" class="tab-panel" aria-label="Configuration">
        <div class="panel-grid">
          <div class="card" data-tour-step data-tour-title="Define the configuration" data-tour-content="Select programme features, set cohort scale, adjust costs, and apply to update outputs.">
            <div class="card-header">
              <h2>Programme configuration</h2>
            </div>
            <div class="card-body">
              <div class="form-grid">
                <div class="form-field">
                  <label for="program-tier">Programme tier</label>
                  <select id="program-tier">
                    <option value="frontline">Frontline</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                  </select>
                </div>

                <div class="form-field">
                  <label for="career-track">Career incentive</label>
                  <select id="career-track">
                    <option value="certificate">Government and partner certificate</option>
                    <option value="uniqual">University qualification</option>
                    <option value="career_path">Government career pathway</option>
                  </select>
                </div>

                <div class="form-field">
                  <label for="mentorship">Mentorship intensity</label>
                  <select id="mentorship">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                  </select>
                </div>

                <div class="form-field">
                  <label for="delivery">Delivery mode</label>
                  <select id="delivery">
                    <option value="blended" selected>Blended</option>
                    <option value="inperson">Fully in person</option>
                    <option value="online">Fully online</option>
                  </select>
                </div>

                <div class="form-field">
                  <label for="response">Outbreak response time</label>
                  <select id="response">
                    <option value="30" disabled>Detect and respond within 30 days</option>
                    <option value="15" disabled>Detect and respond within 15 days</option>
                    <option value="7" selected>Detect and respond within 7 days</option>
                  </select>
                  <span class="help-inline">Response time is fixed at within 7 days in this version.</span>
                </div>

                <div class="form-field span-2">
                  <label for="cost-slider">Cost per trainee per month</label>
                  <div class="slider-row">
                    <input id="cost-slider" type="range" min="0" max="200000" step="500" value="50000" />
                    <div class="slider-value">
                      <span id="cost-display">INR 50,000</span>
                    </div>
                  </div>
                  <span class="help-inline">Used in both the preference model and the programme cost calculation.</span>
                </div>

                <div class="form-field">
                  <label for="trainees">Trainees per cohort</label>
                  <input id="trainees" type="number" min="1" step="1" value="25" />
                </div>

                <div class="form-field">
                  <label for="cohorts">Number of cohorts</label>
                  <input id="cohorts" type="number" min="1" step="1" value="5" />
                </div>

                <div class="form-field">
                  <label for="planning-horizon">Planning horizon (years)</label>
                  <input id="planning-horizon" type="number" min="1" step="1" value="5" />
                  <span class="help-inline">Overrides the session planning horizon for this scenario if provided.</span>
                </div>

                <div class="form-field">
                  <label>Opportunity cost</label>
                  <div id="opp-toggle" class="switch on" role="switch" aria-checked="true" tabindex="0">
                    <div class="switch-knob" aria-hidden="true"></div>
                    <div class="switch-label">Opportunity cost included</div>
                  </div>
                </div>

                <div class="form-field span-2">
                  <label for="scenario-name">Scenario name</label>
                  <input id="scenario-name" type="text" placeholder="Optional name for this configuration" />
                </div>

                <div class="form-field span-2">
                  <label for="scenario-notes">Scenario notes</label>
                  <textarea id="scenario-notes" rows="3" placeholder="Optional notes to store with the scenario"></textarea>
                </div>
              </div>

              <div class="btn-row">
                <button id="update-results" class="btn-primary" type="button">Apply configuration</button>
                <button id="save-scenario" class="btn-ghost" type="button">Save scenario</button>
                <button id="open-snapshot" class="btn-ghost" type="button">Open summary</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Configuration summary</h2>
            </div>
            <div class="card-body">
              <div class="headline">
                <div class="headline-top">
                  <div class="headline-title">Headline assessment</div>
                  <div id="headline-status-tag" class="status-tag status-neutral">Scenario assessed</div>
                </div>

                <div id="headline-recommendation" class="headline-text">
                  Apply a configuration to populate this headline summary.
                </div>

                <div class="headline-sub">
                  <div class="headline-subtitle">Briefing text for discussions</div>
                  <div id="headline-briefing-text" class="headline-text-muted">
                    Apply a configuration to populate the national level briefing text.
                  </div>
                </div>
              </div>

              <div class="split">
                <div class="split-left">
                  <div class="section-title">Inputs</div>
                  <div id="config-summary" class="config-summary"></div>
                </div>

                <div class="split-right">
                  <div class="section-title">
                    Endorsement
                    <span class="pill">
                      <span class="pill-label">Predicted endorsement</span>
                      <span id="config-endorsement-value" class="pill-value">-</span>
                    </span>
                  </div>

                  <div class="chart-card">
                    <canvas id="chart-uptake" height="170" aria-label="Endorsement chart" role="img"></canvas>
                  </div>

                  <div class="section-title">Cost and outbreak benefit</div>
                  <div class="chart-card">
                    <canvas id="chart-bcr" height="170" aria-label="Cost and outbreak benefit chart" role="img"></canvas>
                  </div>

                  <div class="section-title">Graduates and outbreak responses</div>
                  <div class="chart-card">
                    <canvas id="chart-epi" height="170" aria-label="Epidemiological outputs chart" role="img"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-results" class="tab-panel" aria-label="Results">
        <div class="panel-grid">
          <div class="card" data-tour-step data-tour-title="Core results" data-tour-content="Review endorsement, willingness to pay, costs, and outbreak benefit outputs for the current configuration.">
            <div class="card-header">
              <h2>
                Results for the current configuration
                <span id="wtp-section-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
              </h2>
            </div>
            <div class="card-body">
              <div class="kpi-grid">
                <div class="kpi">
                  <div class="kpi-label">
                    Endorsement rate
                    <span id="result-endorsement-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="endorsement-rate" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Opt out rate
                    <span id="result-optout-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="optout-rate" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    WTP per trainee per month
                    <span id="result-wtp-trainee-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="wtp-per-trainee" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Total WTP per cohort
                    <span id="result-wtp-cohort-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="wtp-total-cohort" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Programme cost per cohort
                    <span id="result-prog-cost-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="prog-cost-per-cohort" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Total economic cost per cohort
                    <span id="result-total-cost-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="total-cost" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Net outbreak benefit per cohort
                    <span id="result-net-benefit-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="net-benefit" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Benefit cost ratio per cohort
                    <span id="result-bcr-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="bcr" class="kpi-value">-</div>
                </div>
              </div>

              <div class="divider"></div>

              <div class="section-title">
                Epidemiological implications
                <span id="mixedlogit-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
              </div>

              <div class="kpi-grid">
                <div class="kpi">
                  <div class="kpi-label">
                    Graduates (all cohorts)
                    <span id="result-epi-graduates-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="epi-graduates" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Outbreak responses per year (national)
                    <span id="result-epi-outbreaks-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="epi-outbreaks" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Outbreak benefit per cohort
                    <span id="result-epi-benefit-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="epi-benefit" class="kpi-value">-</div>
                </div>
              </div>

              <div class="divider"></div>

              <div class="callout">
                <div class="callout-title">
                  Opt out alternative
                  <span id="optout-alt-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                </div>
                <p class="callout-text">
                  The opt out alternative represents a scenario where no new FETP training is funded under the current configuration.
                </p>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Model and assumptions summary</h2>
            </div>
            <div class="card-body">
              <div class="mini-grid">
                <div class="mini">
                  <div class="mini-label">Preference model</div>
                  <div class="mini-value">
                    Mixed logit
                    <span id="mixedlogit-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                </div>

                <div class="mini">
                  <div class="mini-label">Cost components</div>
                  <div class="mini-value">
                    Combined templates
                    <span id="cost-components-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                </div>

                <div class="mini">
                  <div class="mini-label">Outbreak benefit method</div>
                  <div class="mini-value">
                    Graduates to responses to value
                    <span id="epi-implications-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                </div>
              </div>

              <div class="note">
                All values are scenario dependent. Adjust planning horizon, discount rate, completion rates, outbreaks per graduate, and value per outbreak in Settings.
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-costing" class="tab-panel" aria-label="Costing">
        <div class="panel-grid">
          <div class="card" data-tour-step data-tour-title="Cost composition" data-tour-content="Explore cohort costs and the component shares used by the combined templates for the selected tier.">
            <div class="card-header">
              <h2>
                Cost composition
                <span id="cost-components-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
              </h2>
            </div>
            <div class="card-body">
              <div class="form-grid">
                <div class="form-field span-2">
                  <label for="cost-source">Cost template source</label>
                  <select id="cost-source"></select>
                  <span class="help-inline">Combined templates are used by tier. Selecting a template updates the displayed breakdown.</span>
                </div>
              </div>

              <div id="cost-breakdown-summary" class="cost-summary-grid"></div>

              <div class="table-wrap">
                <table class="table" aria-label="Cost components">
                  <thead>
                    <tr>
                      <th>Component</th>
                      <th class="numeric-cell">Direct share</th>
                      <th class="numeric-cell">Amount per cohort</th>
                      <th class="numeric-cell">Per trainee per month</th>
                      <th>Notes</th>
                    </tr>
                  </thead>
                  <tbody id="cost-components-list"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Interpretation</h2>
            </div>
            <div class="card-body">
              <div class="callout">
                <div class="callout-title">
                  Opportunity cost
                  <span id="opp-cost-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                </div>
                <p class="callout-text">
                  When enabled, opportunity cost is applied as a tier specific multiplier to the programme cost per cohort. This is reported separately and added to produce the total economic cost.
                </p>
              </div>
              <div class="callout">
                <div class="callout-title">
                  Component shares
                  <span id="cost-components-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                </div>
                <p class="callout-text">
                  Component shares show how the programme cost is distributed across cost categories within the combined template for the selected tier.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-national" class="tab-panel" aria-label="National view">
        <div class="panel-grid">
          <div class="card" data-tour-step data-tour-title="National totals" data-tour-content="This tab aggregates costs, outbreak benefits, and willingness to pay across all configured cohorts.">
            <div class="card-header">
              <h2>National level implications across all cohorts</h2>
            </div>
            <div class="card-body">
              <div class="kpi-grid">
                <div class="kpi">
                  <div class="kpi-label">
                    Total economic cost
                    <span id="natsim-total-cost-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="nat-total-cost" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Total outbreak benefit
                    <span id="natsim-total-benefit-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="nat-total-benefit" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Net outbreak benefit
                    <span id="natsim-net-benefit-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="nat-net-benefit" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    National benefit cost ratio
                    <span id="natsim-bcr-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="nat-bcr" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Total graduates
                    <span id="natsim-graduates-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="nat-graduates" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Outbreak responses per year
                    <span id="natsim-outbreaks-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="nat-outbreaks" class="kpi-value">-</div>
                </div>

                <div class="kpi">
                  <div class="kpi-label">
                    Total willingness to pay
                    <span id="natsim-total-wtp-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
                  </div>
                  <div id="nat-total-wtp" class="kpi-value">-</div>
                </div>
              </div>

              <div class="divider"></div>

              <div id="natsim-summary-text" class="summary-text">
                Apply a configuration to populate national level results.
              </div>

              <div class="divider"></div>

              <div class="two-col-charts">
                <div class="chart-card">
                  <div class="chart-title">Total cost versus outbreak benefit</div>
                  <canvas id="chart-nat-cost-benefit" height="210" aria-label="National cost and benefit chart" role="img"></canvas>
                </div>
                <div class="chart-card">
                  <div class="chart-title">Graduates and outbreak responses</div>
                  <canvas id="chart-nat-epi" height="210" aria-label="National epidemiological chart" role="img"></canvas>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Notes</h2>
            </div>
            <div class="card-body">
              <p class="note">
                National totals scale cohort results by the number of cohorts. Outbreak benefit values depend on the planning horizon, discount rate, value per outbreak, completion rate, and outbreaks per graduate assumptions set in Settings.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-sensitivity" class="tab-panel" aria-label="Sensitivity">
        <div class="card" data-tour-step data-tour-title="Sensitivity and benefit definitions" data-tour-content="Choose how benefits are defined, whether outbreak benefits are included, and optionally override endorsement used for scaling.">
          <div class="card-header">
            <h2>
              WTP based benefits and sensitivity
              <span id="sensitivity-headline-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
            </h2>
          </div>
          <div class="card-body">
            <div class="controls-row">
              <div class="control">
                <label for="benefit-definition-select">WTP benefit definition</label>
                <select id="benefit-definition-select">
                  <option value="wtp_only" selected>Use total WTP without endorsement scaling</option>
                  <option value="endorsement_adjusted">Scale WTP by endorsement used</option>
                </select>
              </div>

              <div class="control">
                <label>Include epidemiological outbreak benefits</label>
                <div id="sensitivity-epi-toggle" class="switch on" role="switch" aria-checked="true" tabindex="0">
                  <div class="switch-knob" aria-hidden="true"></div>
                  <div class="switch-label">Outbreak benefits included</div>
                </div>
              </div>

              <div class="control">
                <label for="endorsement-override">Override endorsement used (percent)</label>
                <input id="endorsement-override" type="number" min="0" max="100" step="0.1" placeholder="Leave blank to use model endorsement" />
              </div>

              <div class="control buttons">
                <button id="refresh-sensitivity-benefits" class="btn-primary" type="button">Refresh summary</button>
                <button id="export-sensitivity-benefits-excel" class="btn-ghost" type="button">Export Excel</button>
                <button id="export-sensitivity-benefits-pdf" class="btn-ghost" type="button">Export PDF</button>
              </div>
            </div>

            <div class="table-wrap">
              <table id="dce-benefits-table" class="table wide" aria-label="WTP based benefits and sensitivity summary">
                <thead>
                  <tr>
                    <th>Scenario</th>
                    <th class="numeric-cell">Total economic cost (INR)</th>
                    <th class="numeric-cell">Total economic cost (million INR)</th>
                    <th class="numeric-cell">Net benefit (million INR)</th>
                    <th class="numeric-cell">Total WTP benefits (INR)</th>
                    <th class="numeric-cell">Outbreak response component of WTP (INR)</th>
                    <th class="numeric-cell">Epidemiological outbreak benefits (INR)</th>
                    <th class="numeric-cell">Endorsement used (percent)</th>
                    <th class="numeric-cell">Effective WTP benefit (INR)</th>
                    <th class="numeric-cell">BCR (WTP only)</th>
                    <th class="numeric-cell">NPV (WTP only, INR)</th>
                    <th class="numeric-cell">BCR (combined)</th>
                    <th class="numeric-cell">NPV (combined, INR)</th>
                  </tr>
                </thead>
                <tbody id="dce-benefits-table-body"></tbody>
              </table>
            </div>

            <div class="divider"></div>

            <div class="table-wrap">
              <table class="table wide" aria-label="Sensitivity detail diagnostics">
                <thead>
                  <tr>
                    <th>Scenario</th>
                    <th>Preference model</th>
                    <th class="numeric-cell">Endorsement</th>
                    <th class="numeric-cell">Economic cost per cohort (INR)</th>
                    <th class="numeric-cell">WTP per cohort (INR)</th>
                    <th class="numeric-cell">WTP outbreak component (INR)</th>
                    <th class="numeric-cell">Epidemiological benefit per cohort (INR)</th>
                    <th class="numeric-cell">BCR (WTP only)</th>
                    <th class="numeric-cell">NPV (WTP only, per cohort)</th>
                    <th class="numeric-cell">BCR (combined)</th>
                    <th class="numeric-cell">NPV (combined, per cohort)</th>
                    <th class="numeric-cell">Effective WTP per cohort (INR)</th>
                    <th class="numeric-cell">Effective combined benefit per cohort (INR)</th>
                  </tr>
                </thead>
                <tbody id="sensitivity-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-copilot" class="tab-panel" aria-label="Copilot">
        <div class="panel-grid">
          <div class="card" data-tour-step data-tour-title="Copilot prompt" data-tour-content="Generate a structured prompt that includes a scenario JSON block and a policy brief instruction template.">
            <div class="card-header">
              <h2>
                Copilot policy briefing
                <span id="copilot-howto-info" class="info-icon" aria-label="More information" role="button" tabindex="0">i</span>
              </h2>
            </div>
            <div class="card-body">
              <p id="copilot-howto-text" class="note"></p>

              <div class="copilot-status">
                <div class="status-pill" id="copilot-status-pill">Waiting for configuration</div>
                <div class="status-text" id="copilot-status-text">
                  Apply a configuration, then generate the Copilot prompt.
                </div>
              </div>

              <div class="btn-row">
                <button id="copilot-open-and-copy-btn" class="btn-primary" type="button">
                  Open in Copilot and copy prompt
                </button>
              </div>

              <div class="textarea-wrap">
                <label for="copilot-prompt-output" class="textarea-label">Prepared Copilot prompt</label>
                <textarea id="copilot-prompt-output" rows="18" spellcheck="false"></textarea>
                <div class="help-inline">
                  This panel is editable. If clipboard access is blocked, copy the content manually before pasting into Copilot.
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Privacy and data handling</h2>
            </div>
            <div class="card-body">
              <p class="note">
                This Copilot tab does not transmit any data automatically. It prepares a text package containing the scenario JSON and instructions.
                You copy and paste this text into your own Copilot environment.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-scenarios" class="tab-panel" aria-label="Saved scenarios">
        <div class="card" data-tour-step data-tour-title="Saved scenarios and exports" data-tour-content="Save scenarios to compare them and export the scenario table to Excel or PDF.">
          <div class="card-header">
            <h2>Saved scenarios</h2>
          </div>
          <div class="card-body">
            <div class="btn-row">
              <button id="export-excel" class="btn-ghost" type="button">Export saved scenarios to Excel</button>
              <button id="export-pdf" class="btn-ghost" type="button">Export saved scenarios to PDF</button>
            </div>

            <div class="table-wrap">
              <table id="scenario-table" class="table wide" aria-label="Saved scenarios comparison">
                <thead>
                  <tr>
                    <th>Select</th>
                    <th>Name</th>
                    <th>Tags</th>
                    <th>Tier</th>
                    <th>Career</th>
                    <th>Mentorship</th>
                    <th>Delivery</th>
                    <th>Response time</th>
                    <th class="numeric-cell">Cohorts</th>
                    <th class="numeric-cell">Trainees per cohort</th>
                    <th class="numeric-cell">Cost per trainee per month</th>
                    <th>Preference model</th>
                    <th class="numeric-cell">Endorsement</th>
                    <th class="numeric-cell">WTP per trainee per month</th>
                    <th class="numeric-cell">Total WTP all cohorts</th>
                    <th class="numeric-cell">BCR (outbreak benefits)</th>
                    <th class="numeric-cell">Total economic cost all cohorts</th>
                    <th class="numeric-cell">Indicative outbreak cost saving all cohorts</th>
                    <th class="numeric-cell">Net outbreak cost saving all cohorts</th>
                    <th class="numeric-cell">Outbreak responses per year</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="note">
              Save scenarios from the Configuration tab. The table populates automatically.
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <div class="footer-inner">
        <div class="footer-left">
          <span class="footer-chip">STEPS</span>
          <span class="footer-text">FETP India Decision Aid</span>
        </div>
        <div class="footer-right">
          <span class="footer-text">Session based tool. Use Settings to document assumptions used for calculations.</span>
        </div>
      </div>
    </footer>

    <script src="script.js"></script>
  </body>
</html>
