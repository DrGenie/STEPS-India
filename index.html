<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FETP India Decision Aid Tool</title>

  <!-- Google Fonts for Professional Look -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Icons & libs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkXzk5bV+nTtDIv5R16vuMJ6MqqV9iQ9M/dGv+VY8Gq60YxYFz+4Ib4Hg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
<noscript><p style="color:#c00;text-align:center;margin:20px;">Enable JavaScript to use this tool.</p></noscript>

<div class="container">

  <header>
    <h1>FETP India Decision Aid Tool</h1>
    <p>Design and evaluate FETP configurations with stakeholder WTP, endorsement, costs, QALYs, and PSA. This tool helps decision-makers explore expansion options for Field Epidemiology Training Programs (FETP) in India.</p>
  </header>

  <!-- Error banner -->
  <div id="globalError" class="error-box" style="display:none;"></div>

  <!-- Tabs -->
  <nav id="tabs" role="tablist" class="tabs">
    <button type="button" class="tablink active" data-tab="introTab" aria-selected="true"><i class="fa-solid fa-info-circle"></i> Introduction</button>
    <button type="button" class="tablink" data-tab="attributesTab" aria-selected="false"><i class="fa-solid fa-list"></i> Attributes</button>
    <button type="button" class="tablink" data-tab="inputsTab" aria-selected="false"><i class="fa-solid fa-sliders"></i> Inputs</button>
    <button type="button" class="tablink" data-tab="wtpTab" aria-selected="false"><i class="fa-solid fa-chart-bar"></i> WTP</button>
    <button type="button" class="tablink" data-tab="endorseTab" aria-selected="false"><i class="fa-solid fa-thumbs-up"></i> Endorsement Rate</button>
    <button type="button" class="tablink" data-tab="costsTab" aria-selected="false"><i class="fa-solid fa-calculator"></i> ₹ Cost–Benefit</button>
    <button type="button" class="tablink" data-tab="qalyTab" aria-selected="false"><i class="fa-solid fa-heart-pulse"></i> QALY</button>
    <button type="button" class="tablink" data-tab="psaTab" aria-selected="false"><i class="fa-solid fa-flask"></i> PSA</button>
    <button type="button" class="tablink" data-tab="methodsTab" aria-selected="false"><i class="fa-solid fa-book-open"></i> Methods</button>
    <button type="button" class="tablink" data-tab="scenariosTab" aria-selected="false"><i class="fa-solid fa-folder-open"></i> Saved Scenarios</button>
  </nav>

  <!-- Intro -->
  <section id="introTab" class="tabcontent" style="display:block" tabindex="0">
    <div class="intro-box">
      <p><strong>Purpose:</strong> This tool supports decision-makers in assessing FETP expansion options using discrete-choice experiment (DCE) evidence on willingness-to-pay (WTP) and endorsement rates, combined with cost estimates, health-economic outcomes like Quality-Adjusted Life Years (QALYs), and probabilistic sensitivity analysis (PSA).</p>
      <p><strong>How to Use:</strong> Start by selecting program attributes in the Inputs tab. Adjust sliders for capacity, costs, and other parameters. Click 'Calculate & View Results' to generate outputs across tabs. Save scenarios for comparison and export reports to PDF.</p>
      <ul>
        <li>Choose attribute levels (type, duration, focus, delivery, response time, capacity, cost).</li>
        <li>View marginal and total WTP; predicted endorsement probability based on stakeholder preferences.</li>
        <li>Compute present-value costs, benefits (in ₹), Benefit-Cost Ratio (BCR), and net benefit.</li>
        <li>Estimate QALYs gained, Incremental Cost-Effectiveness Ratio (ICER), and compare to cost-effectiveness thresholds.</li>
        <li>Run Monte Carlo PSA with customizable uncertainty ranges to assess robustness.</li>
        <li>Save multiple scenarios, compare them in tables, and export detailed reports to PDF for sharing.</li>
      </ul>
      <p><strong>Note:</strong> All calculations are based on placeholder DCE coefficients and cost assumptions. Replace with actual data for real-world use.</p>
    </div>
  </section>

  <!-- Attributes -->
  <section id="attributesTab" class="tabcontent" tabindex="0">
    <h2>Attributes & Levels (Reference Levels in Brackets)</h2>
    <p>These attributes define FETP program configurations. Each has discrete levels derived from stakeholder consultations. Reference levels represent the baseline (status quo) for comparisons in WTP and endorsement calculations.</p>
    <div class="attributes-list">
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon"><i class="fa-solid fa-graduation-cap"></i>
          <div class="tooltip">Frontline (reference): Basic training; Intermediate: Mid-level skills; Advanced: Expert-level epidemiology.</div>
        </div>
        <div class="attribute-content">
          <h4>Program Type</h4>
          <p>Frontline (ref): Focuses on basic surveillance; Intermediate: Builds investigative skills; Advanced: Emphasizes leadership and research.</p>
        </div>
      </div>
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon"><i class="fa-solid fa-hourglass-half"></i>
          <div class="tooltip">6 months (reference): Short-term; 12 months: Balanced; 24 months: In-depth training.</div>
        </div>
        <div class="attribute-content">
          <h4>Duration</h4>
          <p>6 months (ref): Quick deployment; 12 months: Comprehensive skill-building; 24 months: Advanced specialization with fieldwork.</p>
        </div>
      </div>
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon"><i class="fa-solid fa-virus-covid"></i>
          <div class="tooltip">Human (reference): Focus on human health; Animal: Veterinary epidemiology; One Health: Integrated human-animal-environment.</div>
        </div>
        <div class="attribute-content">
          <h4>Focus</h4>
          <p>Human (ref): Disease surveillance in people; Animal: Zoonotic threats; One Health: Holistic approach to pandemics.</p>
        </div>
      </div>
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon"><i class="fa-solid fa-laptop-medical"></i>
          <div class="tooltip">In-person (reference): Traditional classroom; Hybrid: Mix of online/in-person; Online: Fully virtual.</div>
        </div>
        <div class="attribute-content">
          <h4>Delivery Mode</h4>
          <p>In-person (ref): Hands-on training; Hybrid: Flexible with some fieldwork; Online: Cost-effective but limited interaction.</p>
        </div>
      </div>
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon"><i class="fa-solid fa-users"></i>
          <div class="tooltip">Scalable from 200 to 1500 trainees annually, affecting costs and impact.</div>
        </div>
        <div class="attribute-content">
          <h4>Annual Capacity</h4>
          <p>200–1500 trainees/year: Determines program scale; higher capacity increases costs but amplifies benefits.</p>
        </div>
      </div>
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon"><i class="fa-solid fa-stopwatch"></i>
          <div class="tooltip">14 days (reference): Standard response; 7/3 days or 24 hours: Faster deployment capabilities.</div>
        </div>
        <div class="attribute-content">
          <h4>Public Health Event Response Capacity</h4>
          <p>14 days (ref): Baseline readiness; Shorter times improve outbreak control but require more resources.</p>
        </div>
      </div>
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon"><i class="fa-solid fa-indian-rupee-sign"></i>
          <div class="tooltip">₹30,000–₹90,000 per trainee per month, covering MoH direct costs.</div>
        </div>
        <div class="attribute-content">
          <h4>Cost to MoH per Trainee per Month</h4>
          <p>₹30,000–₹90,000: Direct training costs; higher values reflect premium features like advanced equipment.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Inputs -->
  <section id="inputsTab" class="tabcontent" tabindex="0">
    <div class="input-card">
      <h2>Scenario Inputs</h2>
      <p>Adjust the following parameters to define your FETP scenario. Selections and sliders allow customization. Warnings will appear for potentially unrealistic combinations (e.g., fully online advanced programs). After input, click 'Calculate & View Results' to populate other tabs.</p>

      <form id="scenarioForm" onsubmit="return false;">
        <div class="input-cards">
          <div class="input-level-card">
            <h3>Program Type <span class="reference">(Frontline)</span></h3>
            <p>Select the training level; advanced types increase costs and WTP.</p>
            <div class="options">
              <label><input type="radio" name="ptype" value="frontline" checked> Frontline</label>
              <label><input type="radio" name="ptype" value="intermediate"> Intermediate</label>
              <label><input type="radio" name="ptype" value="advanced"> Advanced</label>
            </div>
          </div>

          <div class="input-level-card">
            <h3>Duration <span class="reference">(6 months)</span></h3>
            <p>Longer durations enhance skills but raise opportunity costs.</p>
            <div class="options">
              <label><input type="radio" name="duration" value="6" checked> 6 months</label>
              <label><input type="radio" name="duration" value="12"> 12 months</label>
              <label><input type="radio" name="duration" value="24"> 24 months</label>
            </div>
          </div>

          <div class="input-level-card">
            <h3>Focus <span class="reference">(Human)</span></h3>
            <p>One Health integrates sectors for broader impact on zoonoses.</p>
            <div class="options">
              <label><input type="radio" name="focus" value="human" checked> Human</label>
              <label><input type="radio" name="focus" value="animal"> Animal</label>
              <label><input type="radio" name="focus" value="onehealth"> One Health</label>
            </div>
          </div>

          <div class="input-level-card">
            <h3>Delivery Mode <span class="reference">(In-person)</span></h3>
            <p>Online reduces costs but may lower endorsement for hands-on programs.</p>
            <div class="options">
              <label><input type="radio" name="mode" value="inperson" checked> In-person</label>
              <label><input type="radio" name="mode" value="hybrid"> Hybrid</label>
              <label><input type="radio" name="mode" value="online"> Online</label>
            </div>
          </div>

          <div class="input-level-card">
            <h3>Response Capacity <span class="reference">(14 days)</span></h3>
            <p>Faster response boosts WTP by improving outbreak management.</p>
            <div class="options">
              <label><input type="radio" name="resp" value="14" checked> 14 days</label>
              <label><input type="radio" name="resp" value="7"> 7 days</label>
              <label><input type="radio" name="resp" value="3"> 3 days</label>
              <label><input type="radio" name="resp" value="1"> 24 hours</label>
            </div>
          </div>

          <div class="input-level-card">
            <h3>Trainees / Year</h3>
            <p>Scale the program size; affects total costs and benefits proportionally.</p>
            <div class="options slider-option">
              <label for="capSlider"><i class="fa-solid fa-users"></i> <span id="capLabel">200</span></label>
              <input type="range" id="capSlider" min="200" max="1500" step="50" value="200" />
            </div>
          </div>

          <div class="input-level-card">
            <h3>₹ / Trainee / Month (MoH)</h3>
            <p>Direct MoH cost per trainee; higher values decrease endorsement.</p>
            <div class="options slider-option">
              <label for="costSlider"><i class="fa-solid fa-indian-rupee-sign"></i> <span id="costLabel">30,000</span></label>
              <input type="range" id="costSlider" min="30000" max="90000" step="1000" value="30000" />
            </div>
          </div>

          <div class="input-level-card">
            <h3>Stakeholders Represented
              <span class="info-container">
                <button type="button" class="info-button" aria-label="Number of stakeholders aggregated"><i class="fa-solid fa-circle-info"></i></button>
                <span class="tooltip-text">Scales total WTP; set to 1 for per-respondent values or higher to represent broader groups.</span>
              </span>
            </h3>
            <p>Number of stakeholders whose preferences are aggregated in WTP calculations.</p>
            <div class="options slider-option">
              <label for="stakeSlider"><i class="fa-solid fa-people-group"></i> <span id="stakeLabel">500</span></label>
              <input type="range" id="stakeSlider" min="1" max="2000" step="1" value="500" />
            </div>
          </div>

          <div class="input-level-card">
            <h3>Cohorts / Year & Horizon
              <span class="info-container">
                <button type="button" class="info-button" aria-label="Explanation"><i class="fa-solid fa-circle-info"></i></button>
                <span class="tooltip-text">Cohorts/year: Number of training batches annually. Horizon: Evaluation period in years. Discount rate: Annual rate for present value calculations.</span>
              </span>
            </h3>
            <p>Define program rollout and evaluation timeframe for present-value computations.</p>
            <div class="form-mini">
              <label>Cohorts / year <input type="number" id="cohortsYear" min="1" max="4" step="1" value="1"></label>
              <label>Years horizon <input type="number" id="yearsHorizon" min="1" max="10" step="1" value="5"></label>
              <label>Discount rate (%) <input type="number" id="discRate" min="0" step="0.5" value="3"></label>
            </div>
          </div>
        </div>

        <div id="warnings" class="warning-box" style="display:none;"></div>

        <div class="buttons-row">
          <button type="button" id="calcBtn">Calculate & View Results</button>
        </div>
      </form>

      <!-- Modal -->
      <div id="resultModal" class="modal" aria-modal="true" role="dialog">
        <div class="modal-content">
          <span class="close-button" id="closeModalBtn">×</span>
          <div id="modalResults"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- WTP -->
  <section id="wtpTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Marginal Willingness-to-Pay (WTP) in ₹</h4>
      <p>Marginal WTP represents the additional value stakeholders place on each attribute level relative to the reference. Total benefit = (Sum of marginal WTP for chosen levels) × endorsement rate × number of stakeholders. Use this tab to understand preference-driven valuations. Click 'Show Chart' after calculating.</p>
      <div class="buttons-row"><button id="showWTP">Show Chart</button></div>
      <div class="chart-grid">
        <div class="chart-box fixed-height">
          <h3>Marginal WTP (₹)</h3>
          <canvas id="wtpChart"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Endorsement -->
  <section id="endorseTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Predicted Endorsement Rate</h4>
      <p>Endorsement probability is calculated using a logit model based on DCE coefficients. It estimates the percentage of stakeholders who would support the program configuration. Higher utility from attributes increases endorsement. Click 'Show Plot' after calculating.</p>
      <div class="buttons-row"><button id="showEndorse">Show Plot</button></div>
      <div class="chart-grid">
        <div class="chart-box fixed-height">
          <h3>Endorse vs Not Endorse</h3>
          <canvas id="endorseChart"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Cost-Benefit -->
  <section id="costsTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>₹ Cost–Benefit Analysis</h4>
      <p>Compares present-value costs (fixed, per-trainee, MoH) against monetized benefits from WTP. Includes BCR and net benefit. Toggle breakdown for detailed cost components. Results update after calculation.</p>
      <div id="costsBenefitsResults"></div>
      <div class="buttons-row">
        <button type="button" id="toggleBreakdown">Toggle Cost Breakdown</button>
      </div>
      <div id="detailedCostBreakdown" class="cost-cards" style="display:none;"></div>
    </div>
  </section>

  <!-- QALY -->
  <section id="qalyTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>QALY-Based Cost-Effectiveness</h4>
      <p>Estimates present-value QALYs gained from trained epidemiologists. Computes ICER and compares to user-selected thresholds. Adjust QALY per trainee and threshold, then click 'Run QALY Analysis'.</p>
      <div class="form-grid">
        <div class="form-item">
          <label for="qalyPerTrainee">QALY gain per trainee (annual)</label>
          <input type="number" id="qalyPerTrainee" step="0.001" value="0.03">
        </div>
        <div class="form-item">
          <label for="threshold">Threshold (₹/QALY)</label>
          <select id="threshold">
            <option value="150000">₹150,000</option>
            <option value="300000" selected>₹300,000</option>
            <option value="500000">₹500,000</option>
          </select>
        </div>
      </div>
      <div class="buttons-row"><button id="runQALY">Run QALY Analysis</button></div>
      <div id="qalyResults"></div>
      <div class="chart-grid">
        <div class="chart-box fixed-height">
          <h3>ICER vs Threshold</h3>
          <canvas id="qalyChart"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- PSA -->
  <section id="psaTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Probabilistic Sensitivity Analysis (PSA)</h4>
      <p>Simulates uncertainty in costs, WTP, and endorsement using Monte Carlo methods (truncated normal distributions). Reports means, 95% CIs, and probabilities for BCR >1 and ICER < threshold. Adjust SE percentages and iterations, then click 'Run PSA'.</p>
      <div class="form-grid">
        <div class="form-item"><label>SE % Costs <input type="number" id="seCost" value="10" min="0" step="1"></label></div>
        <div class="form-item"><label>SE % WTP <input type="number" id="seWTP" value="10" min="0" step="1"></label></div>
        <div class="form-item"><label>SE % Endorse <input type="number" id="seEndorse" value="5" min="0" step="1"></label></div>
        <div class="form-item"><label>Iterations <input type="number" id="iterations" value="1000" min="200" step="100"></label></div>
      </div>
      <div class="buttons-row"><button id="runPSA">Run PSA</button></div>
      <div id="psaResults"></div>
      <div class="chart-grid">
        <div class="chart-box fixed-height">
          <h3>BCR Distribution</h3>
          <canvas id="psaBCR"></canvas>
        </div>
        <div class="chart-box fixed-height">
          <h3>ICER Distribution</h3>
          <canvas id="psaICER"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Methods -->
  <section id="methodsTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Methods (Detailed Overview)</h4>
      <details open>
        <summary><strong>Costs</strong></summary>
        <p>Present-value (PV) costs are discounted over the horizon. Formula: PV Cost = Σ_t [(Fixed costs × multipliers) + (Per-trainee costs × endorsed trainees) + (MoH training cost)] / (1 + discount rate)^t. Multipliers adjust for program type, duration, etc.</p>
      </details>
      <details>
        <summary><strong>Benefits (₹)</strong></summary>
        <p>Total Benefit = (Sum of marginal WTP for selected levels) × endorsement rate × stakeholders. Marginal WTP derived from DCE marginal rates of substitution.</p>
      </details>
      <details>
        <summary><strong>QALYs</strong></summary>
        <p>PV QALYs = Σ_t [capacity × cohorts/year × endorsement rate × QALY/trainee] / (1 + r)^t. ICER = PV Cost / PV QALYs. Compared to thresholds like ₹300,000/QALY (adjustable).</p>
      </details>
      <details>
        <summary><strong>PSA</strong></summary>
        <p>Monte Carlo simulation with user-defined SE% for inputs. Draws from truncated normal distributions (e.g., endorsement 0.01–0.99). Outputs include mean, 95% CI for BCR & ICER, and probability metrics.</p>
      </details>
      <p><strong>Assumptions:</strong> Linear utility in logit; constant QALY gain; costs scaled by multipliers. Update coefficients with actual DCE data.</p>
    </div>
  </section>

  <!-- Saved Scenarios -->
  <section id="scenariosTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Saved Scenarios</h4>
      <p>Save calculated scenarios for comparison. Table shows key parameters and outcomes. Export all to PDF for reports. Click 'Save Current Scenario' after calculating.</p>
      <div class="buttons-row">
        <button id="saveScenarioBtn">Save Current Scenario</button>
        <button id="exportPDFBtn">Export to PDF</button>
      </div>
      <div class="table-container">
        <table id="scenarioTable">
          <thead>
          <tr>
            <th>Name</th><th>Type</th><th>Dur</th><th>Focus</th><th>Mode</th><th>Resp</th>
            <th>Cap</th><th>₹/T/M</th><th>Stakeh.</th><th>C/Yr</th><th>Years</th><th>Disc%</th>
            <th>Endorse</th><th>WTP</th><th>Cost</th><th>BCR</th><th>Net</th><th>ICER</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <footer>
    <p>© 2025 FETP India Decision Aid Tool. University of Newcastle, Australia. All rights reserved.</p>
  </footer>
</div>

<!-- App JS -->
<script src="script.js"></script>
</body>
</html>
